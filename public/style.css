/* --- === NeuroX iOS 17+ Inspired Theme === --- */

/* Import Fonts: Tajawal (Arabic), Inter (English) */
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
/* Font Awesome already linked in HTML */

:root {
    /* --- Color Palette (Base Dark Mode) --- */
    --system-background-dark: #000000;
    --system-grouped-background-dark: #1C1C1E;
    --system-secondary-grouped-background-dark: #2C2C2E;
    --system-tertiary-background-dark: #232324; /* For elements like output area */

    --label-primary-dark: rgba(255, 255, 255, 0.98);
    --label-secondary-dark: rgba(235, 235, 245, 0.65);
    --label-tertiary-dark: rgba(235, 235, 245, 0.35);
    --label-quaternary-dark: rgba(235, 235, 245, 0.22);

    --separator-opaque-dark: rgba(84, 84, 88, 0.7);
    --separator-non-opaque-dark: #38383A;

    --fill-primary-dark: rgba(120, 120, 128, 0.36);
    --fill-secondary-dark: rgba(120, 120, 128, 0.24);
    --fill-tertiary-dark: rgba(118, 118, 128, 0.16);
    --fill-quaternary-dark: rgba(116, 116, 128, 0.12);

    --modal-background-dark: rgba(44, 44, 46, 0.92);
    --modal-separator-dark: rgba(84, 84, 88, 0.65);
    --modal-button-hover-dark: rgba(116, 116, 128, 0.1);
    --modal-button-active-dark: rgba(116, 116, 128, 0.2);
    --header-background-dark: rgba(0, 0, 0, 0.8);

    /* --- Color Palette (Light Mode) --- */
    --system-background-light: #F2F2F7;
    --system-grouped-background-light: #FFFFFF;
    --system-secondary-grouped-background-light: #F2F2F7; /* Often same as primary grouped */
    --system-tertiary-background-light: #FFFFFF; /* Output area */

    --label-primary-light: rgba(0, 0, 0, 0.9);
    --label-secondary-light: rgba(60, 60, 67, 0.65);
    --label-tertiary-light: rgba(60, 60, 67, 0.35);
    --label-quaternary-light: rgba(60, 60, 67, 0.22);

    --separator-opaque-light: rgba(198, 198, 200, 0.9); /* Slightly opaque */
    --separator-non-opaque-light: #C6C6C8;

    --fill-primary-light: rgba(120, 120, 128, 0.20);
    --fill-secondary-light: rgba(120, 120, 128, 0.16);
    --fill-tertiary-light: rgba(118, 118, 128, 0.12);
    --fill-quaternary-light: rgba(116, 116, 128, 0.08);

    --modal-background-light: rgba(242, 242, 247, 0.92); /* Light, slightly transparent */
    --modal-separator-light: rgba(60, 60, 67, 0.29);
    --modal-button-hover-light: rgba(60, 60, 67, 0.05);
    --modal-button-active-light: rgba(60, 60, 67, 0.1);
    --header-background-light: rgba(242, 242, 247, 0.85);

    /* --- Universal Colors (Adjust if needed per theme) --- */
    --system-blue: #0A84FF;
    --system-green: #30D158; /* Adjusted green for better light mode visibility */
    --system-red: #FF453A;
    --system-orange: #FF9F0A;
    --system-indigo: #5E5CE6;
    --system-teal: #64D2FF;
    --system-gray: #8E8E93;
    --system-gray-2: #AEAEB2; /* Light mode gray adjustment */
    --system-gray-3: #C7C7CC;
    --system-gray-4: #D1D1D6;
    --system-gray-5: #E5E5EA;
    --system-gray-6: #F2F2F7;

    /* --- Font Families --- */
    --font-family-ar: 'Tajawal', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --font-family-en: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --font-family-base: var(--font-family-ar); /* Default to Arabic */

    /* Typography Weights */
    --font-weight-light: 300;
    --font-weight-regular: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;

    /* Sizes & Transitions */
    --sidebar-width: 320px; /* Slightly wider */
    --sidebar-transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
    --base-transition-duration: 0.25s;
    --base-transition-curve: ease-in-out;
    --base-transition: all var(--base-transition-duration) var(--base-transition-curve);
    --animation-curve-bounce: cubic-bezier(0.4, 0, 0.2, 1.4); /* Bounce effect */
    --border-radius-large: 16px;
    --border-radius-medium: 12px;
    --border-radius-small: 8px;
    --border-radius-circle: 50%;

    /* --- Apply Theme Variables --- */
    --system-background: var(--system-background-dark);
    --system-grouped-background: var(--system-grouped-background-dark);
    --system-secondary-grouped-background: var(--system-secondary-grouped-background-dark);
    --system-tertiary-background: var(--system-tertiary-background-dark);
    --label-primary: var(--label-primary-dark);
    --label-secondary: var(--label-secondary-dark);
    --label-tertiary: var(--label-tertiary-dark);
    --label-quaternary: var(--label-quaternary-dark);
    --separator-opaque: var(--separator-opaque-dark);
    --separator-non-opaque: var(--separator-non-opaque-dark);
    --fill-primary: var(--fill-primary-dark);
    --fill-secondary: var(--fill-secondary-dark);
    --fill-tertiary: var(--fill-tertiary-dark);
    --fill-quaternary: var(--fill-quaternary-dark);
    --modal-background: var(--modal-background-dark);
    --modal-separator: var(--modal-separator-dark);
    --modal-button-hover: var(--modal-button-hover-dark);
    --modal-button-active: var(--modal-button-active-dark);
    --header-background: var(--header-background-dark);
    --system-gray-dynamic: var(--system-gray); /* Base gray */
    --system-gray-2-dynamic: var(--system-gray-2);
    --system-gray-3-dynamic: var(--system-gray-3);
    --system-gray-4-dynamic: var(--system-gray-4);
    --system-gray-5-dynamic: var(--system-gray-5);
    --system-gray-6-dynamic: var(--system-gray-6);
}

/* --- Light Theme Override --- */
body.light-theme {
    --system-background: var(--system-background-light);
    --system-grouped-background: var(--system-grouped-background-light);
    --system-secondary-grouped-background: var(--system-secondary-grouped-background-light);
    --system-tertiary-background: var(--system-tertiary-background-light);
    --label-primary: var(--label-primary-light);
    --label-secondary: var(--label-secondary-light);
    --label-tertiary: var(--label-tertiary-light);
    --label-quaternary: var(--label-quaternary-light);
    --separator-opaque: var(--separator-opaque-light);
    --separator-non-opaque: var(--separator-non-opaque-light);
    --fill-primary: var(--fill-primary-light);
    --fill-secondary: var(--fill-secondary-light);
    --fill-tertiary: var(--fill-tertiary-light);
    --fill-quaternary: var(--fill-quaternary-light);
    --modal-background: var(--modal-background-light);
    --modal-separator: var(--modal-separator-light);
    --modal-button-hover: var(--modal-button-hover-light);
    --modal-button-active: var(--modal-button-active-light);
    --header-background: var(--header-background-light);
    --system-gray-dynamic: var(--system-gray); /* Base gray is often fine */
    --system-gray-2-dynamic: var(--system-gray-2);
    --system-gray-3-dynamic: var(--system-gray-3);
    --system-gray-4-dynamic: var(--system-gray-4);
    --system-gray-5-dynamic: var(--system-gray-5);
    --system-gray-6-dynamic: var(--system-gray-6);
}


* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

html {
    font-size: 16px;
    scroll-behavior: smooth;
    height: 100%;
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    text-size-adjust: 100%;
    direction: rtl; /* Default to RTL */
}
html[lang="en"] {
    direction: ltr;
}

body {
    font-family: var(--font-family-base); /* Dynamic font family */
    line-height: 1.5;
    font-weight: var(--font-weight-regular);
    color: var(--label-primary);
    background-color: var(--system-background);
    min-height: 100%;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    position: relative;
    transition: background-color var(--base-transition-duration) var(--base-transition-curve),
                color var(--base-transition-duration) var(--base-transition-curve);
}

/* Apply English font when lang="en" */
html[lang="en"] body {
    font-family: var(--font-family-en);
}

/* Basic Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOutDown {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(15px); }
}
@keyframes slideInRight {
    from { transform: translateX(30px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes slideOutLeft {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(-30px); opacity: 0; }
}
@keyframes slideInLeft {
    from { transform: translateX(-30px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(30px); opacity: 0; }
}


.fade-in {
    opacity: 0; /* Start hidden */
    animation: fadeInUp 0.6s var(--animation-curve-bounce) forwards;
    animation-delay: 0.1s; /* Base delay */
}

/* --- Page Wrapper & Layout --- */
.page-wrapper {
    display: flex; /* Use flex for main layout */
    flex-direction: column;
    min-height: 100vh;
}

/* --- === NEW Sidebar Styling === --- */
/* --- Styles for the sidebar and its internal elements --- */

/* --- Sidebar Container (Sheet Style) --- */
.history-sidebar {
    background-color: var(--system-grouped-background);
    padding: 0; /* Padding handled by inner elements */
    border-top-left-radius: 18px; /* Slightly larger radius */
    border-top-right-radius: 18px;
    position: fixed;
    bottom: 0;
    inset-inline-start: 0;
    inset-inline-end: 0;
    width: 100%;
    max-height: 85vh;
    z-index: 1000;
    /* Softer shadow */
    box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.15);
    transform: translateY(100%);
    transition: transform var(--sidebar-transition),
                background-color var(--base-transition-duration) var(--base-transition-curve),
                box-shadow var(--base-transition-duration) var(--base-transition-curve);
    display: flex;
    flex-direction: column;
    color: var(--label-primary);
    overflow: hidden;
}
body.light-theme .history-sidebar {
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.06);
}

.history-sidebar.open {
    transform: translateY(0);
}

/* --- Sidebar Header --- */
/* Handlebar/Grabber visual element (remains the same) */
.sidebar-header::before {
    content: '';
    display: block;
    width: 40px;
    height: 5px;
    background-color: var(--system-gray-4-dynamic); /* Slightly darker handle */
    border-radius: 2.5px;
    margin: 8px auto 0 auto;
    transition: background-color var(--base-transition-duration) var(--base-transition-curve);
}

.sidebar-header {
    display: flex; /* Use Flexbox */
    justify-content: space-between;
    align-items: center;
    padding: 6px 16px 12px 16px; /* Adjusted padding */
    flex-shrink: 0;
    position: relative; /* Needed for ::before */
}

.sidebar-header h3 {
    font-size: 1.15rem; /* Slightly larger title */
    font-weight: var(--font-weight-semibold);
    color: var(--label-primary);
    margin: 0;
    text-align: center;
    flex-grow: 1; /* Allows centering */
    /* Ensure title doesn't overlap buttons */
    margin-inline-start: 40px;
    margin-inline-end: 40px;
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

/* Sidebar Toggle Buttons (Settings/Close) - No longer absolute */
.sidebar-toggle-btn {
    background-color: var(--fill-tertiary);
    border: none;
    color: var(--label-secondary);
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0;
    width: 30px; /* Consistent size */
    height: 30px;
    border-radius: var(--border-radius-circle);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.2s ease, color 0.2s ease;
    line-height: 1;
    flex-shrink: 0; /* Prevent shrinking */
}
.sidebar-toggle-btn:hover {
    background-color: var(--fill-secondary);
    color: var(--label-primary);
}
/* HTML Order should be: settings-btn, h3, close-sidebar-btn */

/* --- Settings Panel (Inside Sidebar) --- */
.settings-panel {
    padding: 16px 16px 20px 16px; /* Increased padding */
    /* Separator from list/header */
    border-top: 0.5px solid var(--separator-non-opaque);
    /* Subtle background difference */
    background-color: var(--system-secondary-grouped-background);
    display: none; /* Hidden by default */
    flex-shrink: 0;
    transition: background-color var(--base-transition-duration) var(--base-transition-curve),
                border-color var(--base-transition-duration) var(--base-transition-curve),
                opacity 0.2s ease; /* Add opacity transition */
    opacity: 0; /* Start faded out */
}
.settings-panel.visible {
    display: block;
    opacity: 1;
}

.settings-panel h4 {
    font-size: 0.8rem; /* Smaller category title */
    font-weight: var(--font-weight-medium);
    color: var(--label-secondary);
    margin-bottom: 12px; /* Space below title */
    text-transform: uppercase;
    letter-spacing: 0.6px;
    text-align: start;
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

/* Segmented Control Style for Language */
.language-selector {
    display: flex;
    background-color: var(--fill-tertiary); /* Background for the container */
    border-radius: var(--border-radius-small);
    padding: 3px; /* Inner padding around buttons */
    transition: background-color var(--base-transition-duration) var(--base-transition-curve);
}

.language-btn {
    flex: 1;
    padding: 7px 10px; /* Adjusted padding */
    font-size: 0.9rem; /* Slightly smaller */
    font-weight: var(--font-weight-medium);
    border-radius: 7px; /* Slightly smaller radius for inner buttons */
    border: none; /* Remove individual borders */
    background-color: transparent; /* Default transparent background */
    color: var(--label-secondary);
    cursor: pointer;
    transition: background-color 0.25s ease, color 0.25s ease, box-shadow 0.25s ease;
    text-align: center;
    position: relative; /* For potential future markers */
}

/* Active state has distinct background and shadow */
.language-btn.active {
    background-color: var(--system-grouped-background); /* Brighter background */
    color: var(--label-primary);
    font-weight: var(--font-weight-semibold);
    /* Subtle shadow to lift the active button */
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}
body.light-theme .language-btn.active {
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

/* Style inactive buttons on hover */
.language-btn:not(.active):hover {
    color: var(--label-primary); /* Make text brighter on hover */
}

/* --- History List --- */
.history-list {
    list-style: none;
    padding: 8px 16px; /* Vertical and horizontal padding */
    margin: 0;
    flex-grow: 1;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--system-gray-4-dynamic) transparent;
}
.history-list::-webkit-scrollbar { width: 5px; }
.history-list::-webkit-scrollbar-track { background: transparent; }
.history-list::-webkit-scrollbar-thumb { background-color: var(--system-gray-4-dynamic); border-radius: 2.5px; }

.history-item {
    /* Remove border-bottom */
    padding: 12px 4px; /* Increased vertical padding, small horizontal */
    margin-bottom: 4px; /* Add space between items */
    border-radius: var(--border-radius-small); /* Add radius for hover effect */
    font-size: 0.95rem;
    color: var(--label-secondary);
    overflow-wrap: break-word;
    position: relative;
    line-height: 1.45; /* Slightly increased */
    transition: background-color 0.2s ease;
}

/* Hover effect */
.history-item:hover {
    background-color: var(--fill-quaternary);
}

/* Item Labels (User/AI) */
.history-item .history-item-type {
    display: block;
    margin-bottom: 4px;
    font-weight: var(--font-weight-medium);
    /* Use explicit color vars */
    color: var(--label-primary);
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}
/* Keep specific colors */
/* Make sure the JS adds these style attributes or use classes instead */
.history-item .history-item-type[style*="var(--system-blue)"] { color: var(--system-blue) !important; }
.history-item .history-item-type[style*="var(--system-indigo)"] { color: var(--system-indigo) !important; }

/* Item Text */
.history-item .history-item-text {
    color: var(--label-secondary); /* Use secondary label color for text */
    display: block; /* Ensure it takes block space */
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

/* Timestamp */
.history-item .history-timestamp {
    display: block;
    font-size: 0.75rem; /* Smaller timestamp */
    color: var(--label-tertiary);
    margin-top: 5px; /* Increased space above timestamp */
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

.history-empty {
    color: var(--label-secondary);
    text-align: center;
    padding: 5rem 1rem; /* More padding */
    font-size: 1rem;
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

/* --- Sidebar Footer --- */
.sidebar-footer {
    padding: 12px 16px;
    border-top: 0.5px solid var(--separator-non-opaque);
    background-color: var(--system-grouped-background);
    padding-bottom: calc(12px + env(safe-area-inset-bottom));
    flex-shrink: 0;
    transition: background-color var(--base-transition-duration) var(--base-transition-curve),
                border-color var(--base-transition-duration) var(--base-transition-curve);
}
.clear-history-btn {
    background: var(--fill-tertiary); /* Subtle background */
    border: none;
    color: var(--system-red);
    padding: 0.75rem 0.5rem; /* Slightly larger padding */
    border-radius: var(--border-radius-medium); /* Larger radius */
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease;
    font-family: inherit;
    font-size: 1rem;
    font-weight: var(--font-weight-medium);
    width: 100%;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
}
.clear-history-btn:hover {
    background-color: var(--fill-secondary); /* Darker hover */
    color: var(--system-red); /* Keep red color */
}
.clear-history-btn:disabled {
    color: var(--system-gray-4-dynamic); /* More subdued disabled color */
    background-color: var(--fill-quaternary); /* Use faintest fill when disabled */
    cursor: not-allowed;
    opacity: 0.7;
}
.clear-history-btn i {
    font-size: 0.9em;
}

/* --- END NEW Sidebar Styling --- */


/* --- Main Container & Header --- */
.main-container {
    flex-grow: 1; /* Take remaining space */
    padding: 0 16px; /* Side padding */
    padding-bottom: calc(32px + env(safe-area-inset-bottom)); /* Bottom padding */
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 900px; /* Allow slightly wider main content */
    margin: 0 auto; /* Center on large screens */
}

.main-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0; /* Vertical padding, horizontal handled by container */
    padding-top: calc(10px + env(safe-area-inset-top)); /* Top safe area */
    flex-shrink: 0;
    position: sticky; /* Sticky header */
    top: 0;
    background-color: var(--header-background); /* Use theme variable */
    backdrop-filter: blur(15px) saturate(180%);
    -webkit-backdrop-filter: blur(15px) saturate(180%);
    z-index: 100;
    border-bottom: 0.5px solid var(--separator-non-opaque);
    transition: background-color var(--base-transition-duration) var(--base-transition-curve),
                border-color var(--base-transition-duration) var(--base-transition-curve);
}
/* Header button in main content */
.header-button {
    background: transparent;
    border: none;
    color: var(--system-blue);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 8px;
    border-radius: var(--border-radius-circle);
    transition: background-color 0.2s ease;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
}
.header-button:hover {
    background-color: var(--fill-tertiary);
}

.header-title {
    font-size: 1.1rem;
    font-weight: var(--font-weight-semibold);
    color: var(--label-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    /* Center title visually */
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    /* Ensure it doesn't overlap buttons on narrow screens if needed */
    /* max-width: calc(100% - 100px); */
    /* white-space: nowrap; */
    /* overflow: hidden; */
    /* text-overflow: ellipsis; */
}
.logo-icon {
    color: var(--system-blue);
    font-size: 1.2em;
}

/* --- Interaction Zone --- */
.interaction-zone {
    padding: 24px 0; /* Vertical padding */
    text-align: center;
    flex-grow: 1; /* Allow it to grow */
    display: flex;
    flex-direction: column;
    justify-content: center; /* Center content vertically */
}

/* Status Indicator */
.status-container {
    min-height: 40px; /* Reserve space */
    margin-bottom: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
}
.status-indicator {
    color: var(--label-secondary);
    font-size: 0.95rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    transition: color 0.2s ease, background-color var(--base-transition-duration) var(--base-transition-curve);
    background-color: var(--fill-quaternary);
    padding: 6px 14px;
    border-radius: 20px; /* Pill shape */
}
.loader-wrapper { display: inline-block; line-height: 0; }
.loader { /* iOS Activity Indicator Style */
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: inline-block;
    border-top: 2px solid var(--system-gray-dynamic);
    border-right: 2px solid transparent;
    animation: spinLoader 0.8s linear infinite;
}
@keyframes spinLoader { 100% { transform: rotate(360deg); } }

/* --- === NEW Voice Selector Styling === --- */
.voice-selector-container {
    max-width: 320px; /* Slightly wider perhaps */
    margin: 10px auto 24px auto; /* Adjust vertical margin */
    position: relative;
    display: flex; /* Use flex for layout */
    flex-direction: column; /* Stack label and select */
    align-items: center; /* Center items horizontally */
}

.voice-selector-container label {
    display: block;
    font-size: 0.85rem; /* Slightly smaller */
    font-weight: var(--font-weight-medium);
    color: var(--label-secondary);
    margin-bottom: 10px; /* Increased space */
    /* Keep text aligned to start for consistency with other labels */
    width: 100%; /* Ensure it takes container width for alignment */
    text-align: start; /* Align based on LTR/RTL */
    padding: 0 5px; /* Small padding to align text */
    transition: color var(--base-transition-duration) var(--base-transition-curve);
}

#voice-select {
    /* Reset Browser Defaults */
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-color: var(--system-grouped-background); /* Use grouped background */
    border: none; /* Remove default border */
    border-radius: 25px; /* Make it a capsule */
    /* Increased padding for capsule look, adjust space for arrow */
    padding-block: 12px; /* Vertical padding */
    padding-inline-start: 20px; /* Padding before text */
    padding-inline-end: 45px;   /* Padding after text (includes arrow space) */
    width: 100%;
    font-family: inherit;
    font-size: 0.95rem;
    font-weight: var(--font-weight-medium); /* Medium weight */
    color: var(--label-secondary); /* Default text color less prominent */
    cursor: pointer;
    line-height: 1.4;
    text-align: start; /* Align text to start (left/right) */
    /* Add subtle shadow for depth */
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: border-color var(--base-transition-duration) var(--base-transition-curve),
                background-color var(--base-transition-duration) var(--base-transition-curve),
                color var(--base-transition-duration) var(--base-transition-curve),
                box-shadow var(--base-transition-duration) var(--base-transition-curve);

    /* Custom Arrow Styling (Using the same SVG, positioned better) */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
    background-repeat: no-repeat;
    /* Position arrow relative to padding */
    background-size: 16px 16px; /* Explicit size */
    background-position: right 15px center; /* LTR Default */
}
body.light-theme #voice-select {
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}

/* RTL Specific Arrow Position */
html[dir="rtl"] #voice-select {
    background-position: left 15px center;
}

#voice-select:hover {
    background-color: var(--fill-quaternary); /* Subtle hover */
    color: var(--label-primary); /* Make text primary on hover */
}

#voice-select:focus {
    outline: none;
    color: var(--system-blue); /* Change text color to blue on focus */
    background-color: var(--system-grouped-background); /* Keep background consistent */
    /* iOS-style focus ring using box-shadow */
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.4);
}

/* Option styling (might not work perfectly everywhere, but helps) */
#voice-select option {
    background-color: var(--system-grouped-background);
    color: var(--label-primary);
    font-weight: var(--font-weight-regular); /* Regular weight for options */
    padding: 8px 15px; /* Add some padding to options */
}
/* --- === END NEW Voice Selector Styling === --- */


/* Microphone Button */
.microphone-container {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 24px;
    margin-top: 16px; /* Space above mic */
}
.mic-button {
    background-color: var(--system-blue);
    border: none;
    border-radius: var(--border-radius-circle);
    width: 75px;
    height: 75px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    color: white;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
    transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.2s ease, box-shadow 0.2s ease;
    outline: none;
    position: relative;
    z-index: 10;
}
.mic-icon-container { transition: transform 0.15s ease; }
.mic-button i { font-size: 30px; line-height: 1; }

.mic-button:hover:not(:disabled) { transform: scale(1.06); box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25); }
.mic-button:active:not(:disabled) { transform: scale(0.93); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15); }
.mic-button:disabled { background-color: var(--system-gray-3-dynamic); cursor: not-allowed; box-shadow: none; transform: scale(1); }
.mic-button:disabled i { color: var(--system-gray-dynamic); }
body.light-theme .mic-button { box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12); }
body.light-theme .mic-button:hover:not(:disabled) { box-shadow: 0 8px 22px rgba(0, 0, 0, 0.15); }
body.light-theme .mic-button:active:not(:disabled) { box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); }
body.light-theme .mic-button:disabled { background-color: var(--system-gray-5-dynamic); }
body.light-theme .mic-button:disabled i { color: var(--system-gray-3-dynamic); }


/* Pulse Effect */
.pulse-effect {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 50%; background-color: var(--system-blue);
    opacity: 0; z-index: 5; pointer-events: none; transform: scale(0.8);
}
.mic-button.listening { background-color: var(--system-green); }
.mic-button.listening .pulse-effect {
    background-color: var(--system-green);
    animation: simplePulse 1.5s infinite ease-out;
}
@keyframes simplePulse {
    0% { transform: scale(0.9); opacity: 0.6; }
    70% { transform: scale(1.6); opacity: 0; }
    100% { transform: scale(0.9); opacity: 0; }
}

/* Output Area */
.output-area {
    background-color: var(--system-tertiary-background);
    border: 0.5px solid var(--separator-non-opaque);
    border-radius: var(--border-radius-medium);
    padding: 14px 16px;
    min-height: 120px;
    max-height: 40vh; /* Limit height */
    overflow-y: auto;
    text-align: start; /* Adjust based on dir */
    color: var(--label-primary);
    font-size: 1rem;
    line-height: 1.6;
    overflow-wrap: break-word;
    margin-bottom: 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--system-gray-4-dynamic) transparent;
    transition: background-color var(--base-transition-duration) var(--base-transition-curve),
                border-color var(--base-transition-duration) var(--base-transition-curve),
                color var(--base-transition-duration) var(--base-transition-curve);
}
.output-area::-webkit-scrollbar { width: 5px; }
.output-area::-webkit-scrollbar-track { background: transparent; }
.output-area::-webkit-scrollbar-thumb { background-color: var(--system-gray-4-dynamic); border-radius: 2.5px; }

.output-area p {
    margin: 0 0 12px 0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    opacity: 0; /* Start hidden for animation */
    animation: fadeInUp 0.4s var(--base-transition-curve) forwards;
}
.output-area p:last-child { margin-bottom: 0; }

/* Stagger animation for messages */
.output-area p:nth-child(odd) { animation-delay: 0.1s; }
.output-area p:nth-child(even) { animation-delay: 0.2s; }

.output-area .placeholder {
    color: var(--label-secondary);
    justify-content: center;
    font-style: normal;
    display: flex; /* Use flex to center icon and text */
    text-align: center;
    padding: 1.5rem 0;
    opacity: 1;
    animation: none; /* No animation for placeholder */
}

.output-area i.icon { /* Add .icon class to target these */
    color: var(--label-secondary);
    margin-top: 0.15em;
    flex-shrink: 0;
    font-size: 1em; /* Match text size */
    width: 18px; /* Fixed width for alignment */
    text-align: center;
}
.output-area span { flex-grow: 1; }

.output-area .user-text i.icon { color: var(--system-blue); }
.output-area .ai-text i.icon { color: var(--system-indigo); } /* Use different color for AI */
.output-area .error-text i.icon { color: var(--system-red); }
.output-area .error-text { color: var(--system-red); } /* Style error text itself */
.output-area .error-message { /* Specific class added by JS for error messages */
     color: var(--system-red);
}


/* --- Info Section (iOS List Style) --- */
.info-section {
    margin-top: 32px;
    padding: 0; /* Padding handled by container */
}
.info-section h2 {
    font-size: 1.2rem; /* Title size */
    font-weight: var(--font-weight-semibold);
    margin-bottom: 12px;
    color: var(--label-primary);
    text-align: start; /* Adjust based on dir */
    padding: 0 4px; /* Slight padding for title */
}
.info-card-list {
    background-color: var(--system-grouped-background);
    border-radius: var(--border-radius-medium);
    overflow: hidden; /* Clip separators */
    transition: background-color var(--base-transition-duration) var(--base-transition-curve);
}

.info-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 16px;
    border-bottom: 0.5px solid var(--separator-non-opaque);
    transition: background-color 0.2s ease, border-color var(--base-transition-duration) var(--base-transition-curve);
}
.info-card:last-child { border-bottom: none; }
.info-card:hover { background-color: var(--fill-quaternary); }

.card-icon {
    flex-shrink: 0; width: 32px; height: 32px;
    border-radius: var(--border-radius-small);
    display: flex; justify-content: center; align-items: center;
}
.card-icon i { font-size: 16px; color: white; }
.card-icon.tech { background-color: var(--system-indigo); }
.card-icon.feature { background-color: var(--system-orange); }

.card-text { flex-grow: 1; }
.info-card h4 {
    font-size: 1rem; font-weight: var(--font-weight-medium);
    margin-bottom: 2px; color: var(--label-primary);
}
.info-card p {
    font-size: 0.85rem; color: var(--label-secondary);
    line-height: 1.3; margin: 0;
}

/* --- Footer --- */
.platform-footer {
    margin-top: 40px;
    padding-top: 20px;
    /* border-top: 0.5px solid var(--separator-non-opaque); */ /* Optional border */
    font-size: 0.8rem;
    color: var(--label-secondary);
    text-align: center;
}
.footer-links {
    margin-bottom: 6px;
    display: flex; justify-content: center; align-items: center; gap: 4px;
}
.footer-links a {
    color: var(--system-blue); text-decoration: none;
    padding: 2px 6px; border-radius: 4px;
    transition: background-color 0.2s ease;
}
.footer-links a:hover { background-color: var(--fill-tertiary); }
.link-separator { color: var(--label-tertiary); font-weight: var(--font-weight-bold); }
.platform-footer p { margin-top: 6px; font-size: 0.75rem; }


/* --- Responsiveness --- */

/* Medium Screens (Tablets) */
@media (min-width: 768px) {
    html { font-size: 17px; }
    .main-container { padding: 0 32px; padding-bottom: calc(40px + env(safe-area-inset-bottom)); }
    .main-header { padding: 12px 0; padding-top: calc(12px + env(safe-area-inset-top)); }
    .interaction-zone { padding: 32px 0; }
    .output-area { padding: 16px 20px; }
    .info-section h2 { font-size: 1.3rem; }
    .info-card { padding: 14px 20px; }
    .platform-footer { margin-top: 50px; padding-top: 25px; }
    .history-sidebar { max-width: 400px; /* Limit sidebar width */ }
     /* Adjust sidebar to anchor on the appropriate side for larger screens if needed */
     /* html[dir="ltr"] .history-sidebar { inset-inline-start: auto; inset-inline-end: 0; border-radius: 18px 0 0 18px; } */
     /* html[dir="rtl"] .history-sidebar { inset-inline-start: 0; inset-inline-end: auto; border-radius: 0 18px 18px 0; } */
     /* Keep it as a bottom sheet for consistency for now */
}

/* Large Screens (Desktops) - Center content more */
@media (min-width: 1024px) {
    html { font-size: 18px; }
    /* Make main content wider */
    .main-container { max-width: 800px; padding: 0 40px; padding-bottom: calc(50px + env(safe-area-inset-bottom)); }
    .main-header { padding: 14px 0; padding-top: calc(14px + env(safe-area-inset-top));}
    .interaction-zone { padding: 40px 0; }
    .output-area { max-height: 50vh; }
    .info-section h2 { font-size: 1.4rem; margin-bottom: 16px; }
    .info-card { padding: 16px 24px; }
    .platform-footer { margin-top: 60px; padding-top: 30px; }
}

/* Mobile Sidebar Overlay */
body.sidebar-open-mobile::after {
    content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); z-index: 999; /* Below sidebar */
    opacity: 0; visibility: hidden;
    transition: opacity 0.4s ease, visibility 0s linear 0.4s;
}
body.sidebar-open-mobile.sidebar-visible::after { /* Add a class when sidebar animation starts */
    opacity: 1; visibility: visible; transition-delay: 0s;
}


/* --- === Generic Modal Styles (iOS Alert Style) === --- */
.modal-overlay {
    position: fixed; inset: 0;
    background-color: rgba(0, 0, 0, 0.45); /* Slightly darker */
    display: flex; justify-content: center; align-items: center;
    z-index: 2000; opacity: 0; visibility: hidden;
    transition: opacity 0.3s ease-out, visibility 0s linear 0.3s;
    font-family: var(--font-family-base);
    direction: ltr; /* Modals are typically LTR internally for layout, text aligns based on content */
}
/* Override direction if needed based on body */
html[dir="rtl"] .modal-overlay { direction: rtl; }
html[lang="en"] .modal-overlay { font-family: var(--font-family-en); } /* Apply EN font */

.modal-overlay.visible {
    opacity: 1; visibility: visible; transition-delay: 0s;
}

.modal-content {
    background-color: var(--modal-background); /* Use theme variable */
    backdrop-filter: blur(30px) saturate(180%);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    border-radius: 14px; padding: 0; max-width: 320px; width: 88%; /* Slightly wider */
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); color: var(--label-primary);
    text-align: center; max-height: 90vh; display: flex; flex-direction: column;
    overflow: hidden; transform: scale(1.15); opacity: 0;
    transition: transform 0.3s var(--animation-curve-bounce),
                opacity 0.25s ease-out,
                background-color var(--base-transition-duration) var(--base-transition-curve),
                color var(--base-transition-duration) var(--base-transition-curve);
}
body.light-theme .modal-content { box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); }

.modal-overlay.visible .modal-content {
    transform: scale(1); opacity: 1;
}

/* --- Welcome Modal Specific Styles --- */
#welcome-modal-content .modal-header-tabs {
    display: flex;
    justify-content: space-around;
    padding: 12px 10px 0 10px;
    flex-shrink: 0;
    border-bottom: 0.5px solid var(--modal-separator); /* Add separator below tabs */
    margin-bottom: 5px; /* Add small space below separator */
}

.modal-tab-btn {
    background: none; border: none;
    font-family: inherit; font-size: 0.9rem; font-weight: var(--font-weight-medium);
    color: var(--label-secondary); padding: 8px 10px; /* Increased padding */
    cursor: pointer;
    border-bottom: 3px solid transparent; /* Thicker indicator */
    margin-bottom: -1px; /* Overlap border-bottom of header */
    transition: color 0.2s ease, border-color 0.2s ease;
}
.modal-tab-btn:hover { color: var(--label-primary); }
.modal-tab-btn.active {
    color: var(--system-blue);
    border-bottom-color: var(--system-blue);
    font-weight: var(--font-weight-semibold);
}

#welcome-modal-content .modal-tab-content-container {
    padding: 0 16px; /* Remove top padding, handled by modal-body */
    flex-grow: 1;
    overflow: hidden; /* Hide overflowing content during transition */
    position: relative;
    /* Allow container to shrink if content is small */
    min-height: 150px;
}

.modal-tab-panel {
    width: 100%;
    animation-duration: 0.4s;
    animation-fill-mode: forwards;
    animation-timing-function: var(--base-transition-curve);
    display: flex; /* Use flex to structure panel content vertically */
    flex-direction: column;
    /* Ensure panels take up space for smooth transition */
    min-height: 100%;
}
.modal-tab-panel.hidden {
    pointer-events: none;
    animation-name: fadeOutDown;
    /* Keep in layout but invisible during animation */
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    visibility: hidden;
}
.modal-tab-panel.visible {
    animation-name: fadeInUp;
    position: relative; /* Or static, remove absolute */
    opacity: 1;
    visibility: visible;
}


.modal-title {
    font-size: 1.1rem; font-weight: var(--font-weight-semibold);
    color: var(--label-primary);
    margin-bottom: 10px; /* Increased margin */
    line-height: 1.3;
    padding-top: 15px; /* Add padding above title */
    text-align: start; /* Align based on direction */
    flex-shrink: 0; /* Prevent shrinking */
}
html[dir="ltr"] .modal-title { text-align: left; }
html[dir="rtl"] .modal-title { text-align: right; }

.modal-subtitle { /* Used in confirmation step */
    font-size: 1.1rem; font-weight: var(--font-weight-semibold);
    color: var(--label-primary); margin-bottom: 10px;
    padding-top: 15px; /* Consistent padding */
    text-align: center;
    flex-shrink: 0;
}

/* Specific styling for modal bodies inside the welcome modal */
#welcome-modal-content .modal-body {
    font-size: 0.85rem;
    line-height: 1.6; /* Increased line-height for readability */
    color: var(--label-primary); /* Use primary for better readability in modal */
    max-height: 55vh; /* Allow slightly more height */
    overflow-y: auto;
    /* Remove horizontal margin/padding, rely on container padding */
    margin: 0;
    padding: 5px 2px 16px 2px; /* Vertical padding, minimal horizontal */
    scrollbar-width: thin; /* For FF */
    scrollbar-color: var(--system-gray-4-dynamic) transparent;
    text-align: start; /* Align based on direction */
    flex-grow: 1; /* Allow body to take available space */
}
html[dir="ltr"] #welcome-modal-content .modal-body { text-align: left; }
html[dir="rtl"] #welcome-modal-content .modal-body { text-align: right; }

#welcome-modal-content .modal-body::-webkit-scrollbar { width: 5px; }
#welcome-modal-content .modal-body::-webkit-scrollbar-track { background: transparent; }
#welcome-modal-content .modal-body::-webkit-scrollbar-thumb { background-color: var(--system-gray-4-dynamic); border-radius: 2.5px; }


#welcome-modal-content .modal-body p {
    margin-bottom: 10px; /* Spacing between paragraphs */
}

#welcome-modal-content .modal-body strong {
    font-weight: var(--font-weight-semibold);
    color: var(--label-primary); /* Ensure strong text is primary color */
}

#welcome-modal-content .modal-body ul {
    list-style: none;
    padding: 0;
    margin: 12px 0; /* Adjust margin around lists */
}

/* Improved list item styling */
#welcome-modal-content .modal-body li {
    position: relative;
    margin-bottom: 8px; /* Spacing between list items */
    /* Adjust padding based on direction */
}
html[dir="rtl"] #welcome-modal-content .modal-body li { padding-right: 1.6rem; } /* Increased padding */
html[dir="ltr"] #welcome-modal-content .modal-body li { padding-left: 1.6rem; } /* Increased padding */

#welcome-modal-content .modal-body li::before {
    content: "•";
    color: var(--system-blue);
    position: absolute;
    top: 0.05em; /* Fine-tune vertical alignment */
    line-height: inherit;
    font-size: 1.3em; /* Slightly larger bullet */
    /* Adjust position based on direction */
}
html[dir="rtl"] #welcome-modal-content .modal-body li::before { right: 0; }
html[dir="ltr"] #welcome-modal-content .modal-body li::before { left: 0; }

#welcome-modal-content .modal-body li strong { /* Style strong text within list items */
     font-weight: var(--font-weight-medium); /* Less emphasis than paragraph strong */
}


.terms-prompt, .confirmation-message {
    font-size: 0.85rem; color: var(--label-primary);
    margin-top: 10px; margin-bottom: 0; padding-bottom: 18px;
    line-height: 1.4;
    text-align: center;
    flex-shrink: 0;
}
.confirmation-message { padding-bottom: 14px; }

/* Modal Buttons */
.modal-button-group {
    display: flex; width: 100%;
    border-top: 0.5px solid var(--modal-separator);
    margin-top: auto; /* Push buttons to bottom if content is short */
    flex-shrink: 0;
    transition: border-color var(--base-transition-duration) var(--base-transition-curve);
}
/* Ensure single button group takes full width */
.modal-button-group.single-button {
    justify-content: stretch; /* Make button stretch */
}
.modal-button-group.single-button .modal-button {
    border-inline-start: none; /* Remove side border for single button */
    width: 100%; /* Ensure it takes full width */
}


.modal-button {
    display: flex; align-items: center; justify-content: center; gap: 0.5rem;
    padding: 13px 10px; font-size: 1.1rem; font-family: inherit;
    border: none; cursor: pointer; background-color: transparent;
    color: var(--system-blue); flex-grow: 1; width: 50%;
    transition: background-color 0.15s ease; font-weight: var(--font-weight-regular);
    line-height: 1.2; text-align: center; border-radius: 0;
}
.modal-button i { display: none; }

/* Logical properties for border between buttons */
.modal-button + .modal-button { border-inline-start: 0.5px solid var(--modal-separator); }

.modal-button:hover { background-color: var(--modal-button-hover); }
.modal-button:active { background-color: var(--modal-button-active); }

/* Primary button style (used for main actions like 'Continue', 'Got It') */
.modal-button.primary {
    font-weight: var(--font-weight-semibold); /* Keep semibold or bold */
}

/* Specific emphasis for the initial "Continue" button */
#accept-terms-btn.modal-button.primary {
    font-weight: var(--font-weight-bold); /* Make it bold */
    font-size: 1.15rem; /* Slightly larger */
}


.modal-button.secondary { font-weight: var(--font-weight-semibold); }
.modal-button.tertiary { font-weight: var(--font-weight-regular); }


/* --- Microphone Permission Modal Styles --- */
#mic-permission-modal-content .modal-icon {
    font-size: 3rem;
    color: var(--system-blue);
    margin-top: 20px;
    margin-bottom: 15px;
}
#mic-permission-modal-content .modal-title {
    text-align: center;
    margin-bottom: 8px;
    padding-top: 0; /* Override general modal title padding */
}
#mic-permission-modal-content .modal-body {
    text-align: center;
    font-size: 0.9rem;
    max-height: none; /* No scroll needed typically */
    padding: 0 16px 20px 16px; /* Adjust padding */
    overflow-y: visible; /* Ensure no scrollbar appears */
    line-height: 1.5;
}


/* Small screen adjustments */
@media (max-width: 360px) {
    .modal-content { max-width: 280px; }
    .modal-title, .modal-subtitle { font-size: 1.05rem; }
    .modal-body,
    #welcome-modal-content .modal-body, /* Target welcome modal body specifically */
    .terms-prompt,
    .confirmation-message { font-size: 0.8rem; }
    .modal-button { font-size: 1.05rem; padding: 12px 8px;}
     /* Adjust welcome continue button size */
    #accept-terms-btn.modal-button.primary { font-size: 1.1rem; }
}